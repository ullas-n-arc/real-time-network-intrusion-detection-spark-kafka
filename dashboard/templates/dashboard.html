{% extends "base.html" %}

{% block title %}Dashboard - NIDS{% endblock %}

{% block content %}
<div class="container">
    <!-- Page header -->
    <header class="page-header">
        <div class="page-header-content">
            <h1 class="page-title">Network Intrusion Detection Dashboard</h1>
            <p class="page-subtitle">Real-time monitoring and threat detection</p>
        </div>
        
        <div class="page-header-actions">
            <!-- Session selector -->
            <div class="session-selector">
                <label for="session-select" class="visually-hidden">Select session</label>
                <select id="session-select" class="form-select" aria-label="Select monitoring session">
                    <option value="">All Sessions</option>
                </select>
                <button type="button" class="btn btn-icon btn-danger" id="delete-session-btn" title="Delete selected session" aria-label="Delete selected session" disabled>
                    <span aria-hidden="true">üóëÔ∏è</span>
                </button>
            </div>
            
            <!-- Refresh button -->
            <button type="button" class="btn btn-primary" id="refresh-btn" aria-label="Refresh dashboard data">
                <span class="btn-icon" aria-hidden="true">üîÑ</span>
                <span>Refresh</span>
            </button>
            
            <!-- Auto-refresh toggle -->
            <div class="auto-refresh-toggle">
                <label class="toggle-switch">
                    <input type="checkbox" id="auto-refresh-toggle" checked aria-label="Toggle auto-refresh">
                    <span class="toggle-slider"></span>
                </label>
                <span class="toggle-label">Auto-refresh</span>
            </div>
        </div>
    </header>
    
    <!-- Stats overview cards -->
    <section class="stats-section" aria-labelledby="stats-heading">
        <h2 id="stats-heading" class="visually-hidden">Alert Statistics</h2>
        <div class="stats-grid">
            <article class="stat-card stat-card-total" aria-labelledby="total-alerts-label">
                <div class="stat-card-icon" aria-hidden="true">üìä</div>
                <div class="stat-card-content">
                    <p class="stat-value" id="total-alerts" aria-live="polite">-</p>
                    <p class="stat-label" id="total-alerts-label">Total Alerts</p>
                </div>
                <div class="stat-card-trend" id="total-alerts-trend" aria-hidden="true"></div>
            </article>
            
            <article class="stat-card stat-card-high" aria-labelledby="high-severity-label">
                <div class="stat-card-icon" aria-hidden="true">üî¥</div>
                <div class="stat-card-content">
                    <p class="stat-value" id="high-severity" aria-live="polite">-</p>
                    <p class="stat-label" id="high-severity-label">High Severity</p>
                </div>
                <div class="stat-card-badge">Critical</div>
            </article>
            
            <article class="stat-card stat-card-medium" aria-labelledby="medium-severity-label">
                <div class="stat-card-icon" aria-hidden="true">üü†</div>
                <div class="stat-card-content">
                    <p class="stat-value" id="medium-severity" aria-live="polite">-</p>
                    <p class="stat-label" id="medium-severity-label">Medium Severity</p>
                </div>
                <div class="stat-card-badge">Warning</div>
            </article>
            
            <article class="stat-card stat-card-low" aria-labelledby="low-severity-label">
                <div class="stat-card-icon" aria-hidden="true">üü¢</div>
                <div class="stat-card-content">
                    <p class="stat-value" id="low-severity" aria-live="polite">-</p>
                    <p class="stat-label" id="low-severity-label">Low Severity</p>
                </div>
                <div class="stat-card-badge">Info</div>
            </article>
        </div>
    </section>
    
    <!-- Charts section -->
    <section class="charts-section" aria-labelledby="charts-heading">
        <h2 id="charts-heading" class="section-title">Analytics Overview</h2>
        <div class="charts-grid">
            <!-- Attack types distribution chart -->
            <div class="chart-card">
                <div class="chart-card-header">
                    <h3 class="chart-title">Attack Types Distribution</h3>
                    <div class="chart-actions">
                        <button type="button" class="btn btn-sm btn-ghost" id="attack-chart-fullscreen" aria-label="View chart fullscreen">
                            <span aria-hidden="true">‚õ∂</span>
                        </button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="attack-types-chart" role="img" aria-label="Pie chart showing distribution of attack types"></canvas>
                </div>
                <div class="chart-legend" id="attack-types-legend"></div>
            </div>
            
            <!-- Timeline chart -->
            <div class="chart-card">
                <div class="chart-card-header">
                    <h3 class="chart-title">Alert Timeline</h3>
                    <div class="chart-actions">
                        <select id="timeline-range" class="form-select form-select-sm" aria-label="Select time range">
                            <option value="1">Last 1 hour</option>
                            <option value="6">Last 6 hours</option>
                            <option value="24" selected>Last 24 hours</option>
                            <option value="168">Last 7 days</option>
                        </select>
                    </div>
                </div>
                <div class="chart-container chart-container-wide">
                    <canvas id="timeline-chart" role="img" aria-label="Line chart showing alert activity over time"></canvas>
                </div>
            </div>
            
            <!-- Severity breakdown chart -->
            <div class="chart-card">
                <div class="chart-card-header">
                    <h3 class="chart-title">Severity Breakdown</h3>
                </div>
                <div class="chart-container">
                    <canvas id="severity-chart" role="img" aria-label="Doughnut chart showing severity distribution"></canvas>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Recent alerts table -->
    <section class="alerts-section" aria-labelledby="alerts-heading">
        <div class="section-header">
            <h2 id="alerts-heading" class="section-title">Recent Alerts</h2>
            <div class="section-actions">
                <a href="{{ url_for('alerts_page') }}" class="btn btn-secondary">View All Alerts</a>
            </div>
        </div>
        
        <div class="table-container">
            <table class="data-table" id="alerts-table" aria-describedby="alerts-heading">
                <thead>
                    <tr>
                        <th scope="col">
                            <button type="button" class="table-sort" data-sort="timestamp" aria-label="Sort by timestamp">
                                Timestamp
                                <span class="sort-indicator" aria-hidden="true"></span>
                            </button>
                        </th>
                        <th scope="col">
                            <button type="button" class="table-sort" data-sort="attack_type" aria-label="Sort by attack type">
                                Attack Type
                                <span class="sort-indicator" aria-hidden="true"></span>
                            </button>
                        </th>
                        <th scope="col">
                            <button type="button" class="table-sort" data-sort="severity" aria-label="Sort by severity">
                                Severity
                                <span class="sort-indicator" aria-hidden="true"></span>
                            </button>
                        </th>
                        <th scope="col">Session</th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody id="alerts-body">
                    <tr>
                        <td colspan="5" class="table-empty">
                            <div class="empty-state">
                                <span class="empty-icon" aria-hidden="true">üì≠</span>
                                <p>Loading alerts...</p>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        <nav class="pagination" aria-label="Alerts pagination" id="alerts-pagination" style="display: none;">
            <button type="button" class="pagination-btn" id="prev-page" disabled aria-label="Previous page">
                ‚Üê Previous
            </button>
            <span class="pagination-info" id="pagination-info">Page 1 of 1</span>
            <button type="button" class="pagination-btn" id="next-page" disabled aria-label="Next page">
                Next ‚Üí
            </button>
        </nav>
    </section>
</div>

<!-- Alert detail modal -->
<div class="modal" id="alert-detail-modal" role="dialog" aria-labelledby="alert-modal-title" aria-modal="true" hidden>
    <div class="modal-backdrop" data-close-modal></div>
    <div class="modal-content">
        <header class="modal-header">
            <h2 id="alert-modal-title" class="modal-title">Alert Details</h2>
            <button type="button" class="modal-close" data-close-modal aria-label="Close modal">√ó</button>
        </header>
        <div class="modal-body" id="alert-modal-body">
            <!-- Content populated by JavaScript -->
        </div>
        <footer class="modal-footer">
            <button type="button" class="btn btn-secondary" data-close-modal>Close</button>
        </footer>
    </div>
</div>

<!-- Confirm delete modal -->
<div class="modal" id="confirm-delete-modal" role="alertdialog" aria-labelledby="delete-modal-title" aria-describedby="delete-modal-desc" aria-modal="true" hidden>
    <div class="modal-backdrop" data-close-modal></div>
    <div class="modal-content modal-content-sm">
        <header class="modal-header">
            <h2 id="delete-modal-title" class="modal-title">Confirm Deletion</h2>
            <button type="button" class="modal-close" data-close-modal aria-label="Close modal">√ó</button>
        </header>
        <div class="modal-body">
            <p id="delete-modal-desc">Are you sure you want to delete this session and all its alerts? This action cannot be undone.</p>
        </div>
        <footer class="modal-footer">
            <button type="button" class="btn btn-secondary" data-close-modal>Cancel</button>
            <button type="button" class="btn btn-danger" id="confirm-delete-btn">Delete</button>
        </footer>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}?v={{ range(1, 10000)|random }}"></script>
{% endblock %}
